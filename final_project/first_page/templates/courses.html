{% extends 'base.html' %}

{% block content %}
  <h1 style="font-family: monospace; margin-left: 2rem">My Courses</h1>

  {% if user.is_authenticated %}
    {% if courses %}
      <ul>
        {% for course in courses %}
          <li>
            <a href="#" class="course-link"
              data-title="{{ course.title }}"
              data-description="{{ course.description }}"
              data-course-id="{{ course.id }}">
              {{ course.title }}
            </a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>You don't have any courses yet. <a href="{% url 'course_add' %}">Add a course</a>.</p>
    {% endif %}
  {% else %}
    <p>You need to <a href="{% url 'login' %}?next={% url 'courses' %}">sign in</a> to see your courses.</p>
  {% endif %}

  <div id="course-details" style="display: none;">
    <h2 id="course-title"></h2>
    <p id="course-description"></p>
  </div>
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
  <script>
    $(document).ready(function() {
      $('.course-link').click(function(event) {
        event.preventDefault();
        var title = $(this).data('title');
        var description = $(this).data('description');
        var courseId = $(this).data('course-id');
        console.log('Clicked course link. Course ID: ', courseId);
        $('#course-title').text(title);
        $('#course-description').text(description);
        $('#course-details').dialog({
          modal: true,
          width: 500,
          buttons: {
            OK: function() {
              $(this).dialog('close');
            },
            Delete: function() {
              console.log('Delete button clicked. Course ID: ', courseId);
              $.ajax({
                url: '{% url "delete_course" %}',
                type: 'POST',
                data: {'course_id': courseId, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
                success: function(response) {
                  console.log('Successfully deleted course. Response: ', response);
                  window.location.reload();
                },
                error: function(xhr) {
                  console.error('Error deleting course. Response: ', xhr.responseText);
                  alert('Error deleting course.');
                }
              });
              $(this).dialog('close');
            },
            Cancel: function() {
              $(this).dialog('close');
            }
          }
        });
      });
    });
  </script>
  
  <h1 style="font-family: monospace; margin-top: 4rem; margin-left: 2rem">Attendance</h1>
  <p style="border: 1cm">
    This section would post attendance from classes as you attend
  </p>
  <p>Trying to get graphicPie pic to show up here</p>
  <p>This shows an example of what attendance in classes could look like</p>
{% endblock %}
